<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.iu.mk.qna.QnaDAO">
  
  <sql id="search">
  	where
  	<choose>
  		<when test="kind=='ti'">
  			title
  		</when>
  		<when test="kind=='wr'">
  			writer
  		</when>
  		<when test="kind=='co'">
  			contents
  		</when>
  	</choose>
  	like '%'||#{search}||'%'
  </sql>
  
  
  	<select id="boardList"  parameterType="Pager" resultType="QnaVO">
  		select * from
  		(select Q.*, rownum R from
  		(select * from qna
  		<include refid="search"></include>
  			order by ref desc, step asc) Q)
  		where R between #{startRow} and #{lastRow}
  	</select>
  <!-- ref : 원본글과 답글을 묶음. step: 그룹 내에서 정렬 -->
  
  <select id="boardCount" parameterType="Pager" resultType="Long">
  	select count(num) from qna
  		<include refid="search"></include>
  </select>
  
  </mapper>