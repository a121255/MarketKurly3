<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.iu.mk.pay.PayDAO">
	   <resultMap type="CartVO" id="payResult">
	 		<id column="cq_num" property="cq_num"/>
			<result column="p_num" property="p_num"/>
			<result column="count" property="count"/>
			<result column="cart_num" property="cart_num"/>
			<result column="payCheck" property="payCheck"/>
			
			<collection property="productVOs" javaType="List" ofType="ProductVO">
				<id column="p_num" property="p_num"/>
		  		<result column="p_name" property="p_name"/>
		  		<result column="price" property="price"/>
		  		<result column="contents" property="contents"/>
		  		<result column="kind" property="kind"/>
			</collection>
	 
	 </resultMap> 
  

  
  	<select id="scCart" parameterType="Long" resultMap="payResult">
  		 select C.cq_num, P.price from cart C left Join product p
		 on (C.p_num = P.p_num)
		 where cart_num=#{cart_num}
  	</select>
  
  
  	<insert id="payInsert" parameterType="com.iu.mk.pay.PayVO">
  		insert into pay values (pq_num_seq.nextval, #{cq_num}, #{pay_price}, #{order_num})
  	</insert>
  
  	<select id="orderNum" resultType="Long">
		select pq_num_seq.nextval from dual
	</select>
	
	
	
	
	<select id="scPrice" parameterType="Long" resultType="List">
		select price from product where p_num in (select p_num from cart where cq_num in (select cq_num from pay where order_num=#{order_num}));
	</select>
  
  
  	<insert id="payInfoInsert" parameterType="com.iu.mk.pay.PayInfoVO">
  		insert into payInfo values (#{order_num}, #{total_price}, #{delivery}, sysdate)
  	</insert>
  
  
    <update id="payCheckUpdate">
  		update cart set payCheck = 1 where cq_num in (select cq_num from pay where order_num=#{order_num})
  	</update>
  
  	<select id="pCount" parameterType="Long" resultType="Long">
  		select count from cart where cq_num=#{cq_num}
  	</select>
  
  </mapper>